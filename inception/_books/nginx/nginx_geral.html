<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Explicação dos Arquivos NGINX</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
      color: #333;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
    }
    .section {
      background-color: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .code {
      background-color: #ecf0f1;
      padding: 10px;
      border-left: 4px solid #3498db;
      margin: 10px 0;
      font-family: 'Courier New', Courier, monospace;
      white-space: pre-wrap;
    }
    ul {
      list-style-type: disc;
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <h1>Explicação dos Arquivos NGINX</h1>

  <div class="section">
    <h2>Estrutura e Explicação do nginx.conf</h2>
    <div class="code">
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 768;
}

http {

    ##
    # Basic Confs
    ##

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    server_tokens off;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    ##
    # SSL Confs
    ##

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;

    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384;
    ssl_ecdh_curve secp384r1;
    ssl_session_timeout 10m;
    ssl_session_cache shared:SSL:10m;
    ssl_session_tickets off;

    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";

    ##
    # Logging Confs
    ##

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    ##
    # Gzip Confs
    ##

    gzip on;

    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*.conf;
}
    </div>
    <ul>
      <li><strong>user www-data;</strong>: Define o usuário "www-data" para executar o NGINX, alinhando-se com as permissões do sistema.</li>
      <li><strong>worker_processes auto;</strong>: Configura automaticamente o número de processos worker com base nos CPUs disponíveis, otimizando o desempenho.</li>
      <li><strong>pid /run/nginx.pid;</strong>: Especifica o arquivo PID para gerenciar o processo principal do NGINX.</li>
      <li><strong>include /etc/nginx/modules-enabled/*.conf;</strong>: Inclui configurações de módulos habilitados para extensibilidade.</li>
      <li><strong>events { worker_connections 768; }</strong>: Define o número máximo de conexões por worker como 768, controlando a capacidade de processamento.</li>
      <li><strong>sendfile on;</strong>: Habilita o uso de sendfile para transferência eficiente de arquivos estáticos.</li>
      <li><strong>tcp_nopush on; tcp_nodelay on;</strong>: Otimiza o envio de dados com bufferização e desativa atrasos TCP.</li>
      <li><strong>keepalive_timeout 65;</strong>: Define o tempo de espera para conexões persistentes como 65 segundos.</li>
      <li><strong>types_hash_max_size 2048;</strong>: Ajusta o tamanho da tabela hash para tipos MIME, melhorando o desempenho.</li>
      <li><strong>server_tokens off;</strong>: Desativa a exibição de informações de versão no servidor, aumentando a segurança.</li>
      <li><strong>include /etc/nginx/mime.types; default_type application/octet-stream;</strong>: Carrega tipos MIME e define o tipo padrão para dados binários.</li>
      <li><strong>ssl_protocols TLSv1.2 TLSv1.3;</strong>: Habilita apenas TLS 1.2 e 1.3, conforme exigido (página 8).</li>
      <li><strong>ssl_prefer_server_ciphers on;</strong>: Prioriza os cifras do servidor para segurança.</li>
      <li><strong>ssl_ciphers ...;</strong>: Define cifras seguras para criptografia SSL/TLS.</li>
      <li><strong>ssl_ecdh_curve secp384r1;</strong>: Especifica a curva elíptica para segurança avançada.</li>
      <li><strong>ssl_session_timeout 10m; ssl_session_cache shared:SSL:10m; ssl_session_tickets off;</strong>: Configura o cache de sessão SSL para 10 minutos, desativando tickets para segurança.</li>
      <li><strong>add_header Strict-Transport-Security ...;</strong>: Adiciona cabeçalho HSTS para forçar HTTPS por 2 anos.</li>
      <li><strong>add_header X-Frame-Options DENY;</strong>: Impede o carregamento em iframes, protegendo contra ataques de cliquejacking.</li>
      <li><strong>add_header X-Content-Type-Options nosniff;</strong>: Impede o navegador de adivinhar tipos MIME, aumentando a segurança.</li>
      <li><strong>add_header X-XSS-Protection "1; mode=block";</strong>: Ativa proteção contra ataques XSS, bloqueando páginas suspeitas.</li>
      <li><strong>access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log;</strong>: Define os arquivos de log para acesso e erros.</li>
      <li><strong>gzip on;</strong>: Habilita a compressão Gzip para reduzir o tamanho dos dados transferidos.</li>
      <li><strong>include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*.conf;</strong>: Inclui configurações adicionais e sites habilitados.</li>
    </ul>
  </div>

  <div class="section">
    <h2>Estrutura e Explicação do default.conf</h2>
    <div class="code">
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;
    return 301 https://DOMAIN_NAME$request_uri;
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name DOMAIN_NAME;
    index index.php;
    root /var/www/wordpress;

    ssl_certificate /etc/nginx/ssl/nginx-selfsigned.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx-selfsigned.key;

    location / {
        try_files $uri $uri/ /index.php$is_args$args;
    }

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass wordpress:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
    </div>
    <ul>
      <li><strong>listen 80 default_server; listen [::]:80 default_server;</strong>: Escuta na porta 80 (HTTP) para IPv4 e IPv6 como servidor padrão.</li>
      <li><strong>server_name _;</strong>: Aceita qualquer hostname para o redirecionamento.</li>
      <li><strong>return 301 https://DOMAIN_NAME$request_uri;</strong>: Redireciona todas as solicitações HTTP para HTTPS com o domínio especificado.</li>
      <li><strong>listen 443 ssl; listen [::]:443 ssl;</strong>: Escuta na porta 443 (HTTPS) com SSL para IPv4 e IPv6.</li>
      <li><strong>server_name DOMAIN_NAME;</strong>: Define o nome do domínio (substituído dinamicamente).</li>
      <li><strong>index index.php;</strong>: Define index.php como arquivo padrão.</li>
      <li><strong>root /var/www/wordpress;</strong>: Define o diretório raiz como o local dos arquivos do WordPress.</li>
      <li><strong>ssl_certificate /etc/nginx/ssl/nginx-selfsigned.crt;</strong>: Usa o certificado SSL autoassinado.</li>
      <li><strong>ssl_certificate_key /etc/nginx/ssl/nginx-selfsigned.key;</strong>: Usa a chave privada correspondente.</li>
      <li><strong>location / { try_files $uri $uri/ /index.php$is_args$args; }</strong>: Serve arquivos estáticos ou redireciona para index.php.</li>
      <li><strong>location ~ \.php$ { ... }</strong>: Processa solicitações PHP, passando-as ao PHP-FPM.</li>
      <li><strong>fastcgi_pass wordpress:9000;</strong>: Envia solicitações PHP ao contêiner WordPress na porta 9000.</li>
      <li><strong>include fastcgi_params; fastcgi_param SCRIPT_FILENAME ...;</strong>: Configura parâmetros FastCGI para scripts PHP.</li>
    </ul>
  </div>

  <div class="section">
    <h2>Integração com WordPress e MariaDB</h2>
    <ul>
      <li>O NGINX atua como ponto de entrada (página 8), redirecionando HTTP para HTTPS e servindo arquivos estáticos do WordPress.</li>
      <li>Passa solicitações PHP ao contêiner WordPress (fastcgi_pass wordpress:9000), que usa PHP-FPM para processamento dinâmico.</li>
      <li>Conecta-se ao MariaDB via rede Docker para dados do WordPress, usando TLSv1.2/TLSv1.3 na porta 443.</li>
    </ul>
  </div>
</body>
</html>
